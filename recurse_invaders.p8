pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
t=0
objects={}

function _init()
	-- the current time
	t=0

	add(objects,ship)
	add(objects,enemies)

	for object in all(objects) do
		object:init()
	end
end

function _update60()
	--increment time
	t+=1
	
	for object in all(objects) do
		object:update()
	end
end

function _draw()
	-- clear screen
	cls()

	for object in all(objects) do
		object:draw()
	end
end

-->8
-- ship
ship={}

function ship.init(self)
	self.x=60	-- x pos
	self.y=110	-- y pos
	self.w=12 -- width in pixels
	self.h=16	-- height in pixels
	self.sp=1 -- ship sprite
	self.spw=2-- sprite width
	self.sph=2 -- sprite height
end

function ship.update(self)
	if btn(0) then
		self.x-=1
	elseif btn(1) then
		self.x+=1
	end
	
	self.x=mid(
		0, 
		self.x,
		128-self.w)
end

function ship.draw(self)
	--animate the ship
	if t%8<5 then
		ship.sp=3
	else
		ship.sp=1
	end

	-- draw ship sprite
	spr(
		ship.sp,
		ship.x,
		ship.y,
		ship.w/8,
		ship.h/8
	)
end
-->8
--enemies
enemies={}

function enemies.init(self)
	-- holds all active enemies
	self.rows={}

	-- direction of movement
	self.dir=1

	-- speed of movement
	self.speed=4
	
	-- amount to drop
	self.dropy=4
	
	-- y offset of wave
	self.yoff=0

	-- sprite animation offset
	self.anim_offset=16

	-- width/height of the wave
	self.width=0
	self.height=0

	-- the coords of where we can
	-- place a new enemy
	self.nextx=0
	self.nexty=4
	self.current_row=1
	
	self.types={
		-- enemy type 1
		{sp1=64,sp2=80},
		-- enemy type 2
		{sp1=65,sp2=81},
		-- enemy type 3
		{sp1=66,sp2=82}
	}
	
	local enemy_rows={1,2,2,3,3}
	for row,etype in pairs(enemy_rows) do
		self.rows[row]={}
		for i=0,7 do
			self:add_enemy(row,i,etype)
		end
	end
end

function enemies.add_enemy(self,row,col,etype)
	local e={
		sp1=self.types[etype].sp1,
		sp2=self.types[etype].sp2,
		x=col*12,
		y=row*12,
		row=row
	}
	
	add(self.rows[row],e)
end

function enemies.update(self)
	-- move the enemies
	if t%(60/self.speed)==0 then
		self.anim_offset=self.anim_offset==0 and 16 or 0
		for row in all(self.rows) do
			for e in all(row) do
 			e.x+=self.dir
 		end
 	end

		-- change dir if necessary
		for row in all(self.rows) do
			if row[#row].x+8>=127 or row[1].x<=0 then
				self.dir=-self.dir
				self.yoff+=self.dropy
				break
			end
		end
	end
end

function enemies.draw(self)
	for row in all(self.rows) do
		for enemy in all(row) do
		pal(7,6+enemy.row)
		spr(
			enemy.sp1+self.anim_offset,
			enemy.x,
			enemy.y+self.yoff)
		pal()
		end
	end
end
__gfx__
00000000555555555555000055555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000577777777775000057777777777500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000570000000075000057111111117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007070057b0b0b00075000057b1b1b1117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000570000000075000057111111117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000570bb0bb00750000571bb1bb117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000700570000000075000057111111117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000577777777775000057777777777500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555000055555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000055550000000000005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055555555550000005555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555757575755000055575757575500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000557575757555000055757575755500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555000055555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000bb00b000bb000000bb000b00bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b00000b0000b00000b000b0000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000070000700077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007007000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777700077770077d77d7700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77d77d7707d77d707777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777777777770070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700707007070707707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077070070000700700007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700007007007000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000070000700077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007007000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777707077770777d77d7700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77d77d7777d77d777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777777777770070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077070007007000707707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000007070000700700007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000070700000070070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
