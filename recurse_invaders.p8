pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
t=0 -- frame counter
fps=60 -- frame rate
objects={} -- all game objects

-- called once at game start
function _init()
	add(objects,ship)
	add(objects,enemies)

	for object in all(objects) do
		object:init()
	end
end

-- called 60 times a sec
function _update60()
	-- increment time
	t+=1
	
	-- update all game objects
	for object in all(objects) do
		object:update()
	end
end

-- also called 60 times a sec
-- after _update60() 
function _draw()
	cls()	-- clear screen

	-- draw all game objects
	for object in all(objects) do
		object:draw()
	end
end

-->8
-- ship
ship={}

function ship.init(self)
	self.x=60		-- x pos
	self.y=110	-- y pos
	self.w=12 	-- width in pixels
	self.h=16		-- height in pixels
	self.sp=1	 -- ship sprite
end

function ship.update(self)
	if btn(0) then
		self.x-=1
	elseif btn(1) then
		self.x+=1
	end
	
	self.x=mid(
		0, 
		self.x,
		128-self.w)
end

function ship.draw(self)
	--animate the ship
	if t%8<5 then
		ship.sp=3
	else
		ship.sp=1
	end

	-- draw ship sprite
	spr(
		ship.sp,
		ship.x,
		ship.y,
		ship.w/8,
		ship.h/8
	)
end
-->8
--enemies
enemies={
	rows={},	-- the enemy rows
	dir=1,			-- movement direction
	speed=4,	-- move speed
	y_drop=4,-- drop amount
	y_off=0,	-- wave y offset
	anim=0,	 -- anim frame number 
 types={
 		{sp=64}, -- enemy type 1
 		{sp=65}, -- enemy type 2
 		{sp=66}  -- enemy type 1
 	}
}

function enemies.init(self)	
	local enemy_rows={1,2,2,3,3}
	for row,etype in pairs(enemy_rows) do
		self.rows[row]={}
		for i=0,7 do
			self:add_enemy(row,i,etype)
		end
	end
end

function enemies.add_enemy(self,row,col,etype)
	local e={
		sp=self.types[etype].sp,
		x=col*12,
		y=row*12,
		row=row
	}
	
	add(self.rows[row],e)
end

function enemies.update(self)
	-- move the enemies
	if t%(60/self.speed)==0 then
		self.anim=self.anim==0 and 1 or 0
		for row in all(self.rows) do
			for e in all(row) do
 			e.x+=self.dir
 		end
 	end

		-- change dir if necessary
		for row in all(self.rows) do
			if row[#row].x+8>=127 or row[1].x<=0 then
				self.dir=-self.dir
				self.y_off+=self.y_drop
				break
			end
		end
	end
end

function enemies.draw(self)
	for row in all(self.rows) do
		for enemy in all(row) do
		pal(7,6+enemy.row)
		spr(
			enemy.sp+self.anim*16,
			enemy.x,
			enemy.y+self.y_off)
		pal()
		end
	end
end
__gfx__
00000000555555555555000055555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000577777777775000057777777777500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000570000000075000057111111117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007070057b0b0b00075000057b1b1b1117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000570000000075000057111111117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000570bb0bb00750000571bb1bb117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000700570000000075000057111111117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000577777777775000057777777777500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555000055555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000055550000000000005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055555555550000005555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555757575755000055575757575500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000557575757555000055757575755500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555000055555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000bb00b000bb000000bb000b00bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b00000b0000b00000b000b0000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000070000700077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007007000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777700077770077d77d7700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77d77d7707d77d707777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777777777770070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700707007070707707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077070070000700700007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700007007007000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000070000700077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007007000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777707077770777d77d7700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77d77d7777d77d777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777777777770070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077070007007000707707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000007070000700700007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000070700000070070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
