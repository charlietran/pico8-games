pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
t=0 -- frame counter
fps=60 -- frame rate
objects={} -- all game objects

-- called once at game start
function _init()
	add(objects,ship)
	add(objects,enemies)

	for object in all(objects) do
		object:init()
	end
end -- _init()

-- called 60 times a sec
function _update60()
	t+=1	-- increment time
	
	-- update all game objects
	for object in all(objects) do
		object:update()
	end
end -- _update60()

-- also called 60 times a sec
-- after _update60() 
function _draw()
	cls()	-- clear screen
	map(0,0)
	-- draw all game objects
	for object in all(objects) do
		object:draw()
	end
end -- _draw()

--------------------------------
-->8
-- ship-------------------------
ship={}

function ship.init(self)
	self.x=60		-- x pos
	self.y=110	-- y pos
	self.w=12 	-- width in pixels
	self.h=16		-- height in pixels
	self.sp=1	 -- ship sprite
	self.fired_bullet=false
end -- ship.init()

function ship.update(self)
	if btn(0) then
		self.x-=1
	elseif btn(1) then
		self.x+=1
	end

	if btnp(5) and !self.fired_bullet then
		ship:fire_bullet()
	end
	
	-- clamp the ship position to
	-- be within screen bounds
	self.x=mid(
		0, 
		self.x,
		127-self.w)
end -- ship.update()

function ship.fire_bullet(self)
	ship.fired_bullet=1
	local bullet={
		x=self.x,
		y=self.y
	}

	bullet.draw=function(b)
		spr(67,b.x+2,b.y-10)
	end

	bullet.update=function(b)
		b.y-=2
		if b.y<=0 then
			del(objects,b)
			self.fired_bullet=false
		end
	end

	add(objects,bullet)
end

function ship.draw(self)
	--animate the ship
	if t%8<4 then
		ship.sp=3
	else
		ship.sp=1
	end

	-- draw ship sprite
	spr(
		ship.sp,
		ship.x,
		ship.y,
		ship.w/8,
		ship.h/8
	)
end -- ship.draw()

--------------------------------
-->8
--enemies-----------------------
enemies={
	rows={}, -- the enemy rows
	dir=1, -- movement direction
	speed=4, -- move speed
	y_drop=4, -- drop amount
	y_off=0, -- wave y offset
	anim=0, -- anim frame number 
	types={
		{sp=64}, -- enemy type 1
		{sp=65}, -- enemy type 2
		{sp=66}  -- enemy type 1
	}
}

function enemies.init(self)	
	local e_setup={1,2,2,3,3}
	for row,etype in pairs(e_setup) do
		self.rows[row]={}
		for i=0,7 do
			self:add_enemy(row,i,etype)
		end
	end
end -- enemies.init()

function enemies.add_enemy(self,row,col,etype)
	local e={
		sp=self.types[etype].sp,
		x=col*12,
		y=row*12,
		row=row
	}
	
	add(self.rows[row],e)
end -- enemies.add_enemy()

function enemies.update(self)
	-- move the enemies
	if t%(60/self.speed)==0 then
		self.anim=self.anim==0 and 1 or 0
		for row in all(self.rows) do
			for e in all(row) do
			e.x+=self.dir
		end
	end

		-- change dir if necessary
		for row in all(self.rows) do
			if row[#row].x+8>=127 or row[1].x<=0 then
				self.dir=-self.dir
				self.y_off+=self.y_drop
				break
			end
		end
	end
end -- enemies.update()

function enemies.draw(self)
	for i,row in pairs(self.rows) do
		-- pal() swaps palette colors
		-- for the next thing drawn
		-- here, we're swapping the
		-- default white (#7) in the
		-- enemy sprite for a new one
		pal(7,6+i)

		-- draw each enemy sprite
		for enemy in all(row) do
			spr(
				enemy.sp+self.anim*16,
				enemy.x,
				enemy.y+self.y_off)
		end

		pal() -- reset the palette
	end
end -- enemies.draw()


__gfx__
00000000555555555555000055555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000577777777775000057777777777500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000570000000075000057111111117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007070057b0b0b00075000057b1b1b1117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000570000000075000057111111117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000570bb0bb00750000571bb1bb117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000700570000000075000057111111117500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000577777777775000057777777777500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555000055555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000055550000000000005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055555555550000005555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555757575755000055575757575500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000557575757555000055757575755500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555000055555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000a00a0000000009900000099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000a0000a000000090000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000700007000777700000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007777000070070007777770000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777700077770077d77d77000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77d77d7707d77d7077777777000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
777777777777777700700700000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007007070070707077070000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070770700700007007000070000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000070070070000007000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000070000700077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007007000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777707077770777d77d7700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77d77d7777d77d777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777777777770070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077070007007000707707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000007070000700700007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000070700000070070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000006000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000010000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000
__map__
80818283b0b1b2b3b4b5b6b78485868700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80818283c0c1c2c3c4c5c6c79495969700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90919293d0d1d2d3d4d5d6d7a4a5a6a700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a0a1a2a3e0e1e2e3e4e5e6e7b4b5b6b700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b0b1b2b3f0808182838485868787c6c700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c0c1c2c3c4909192939495969797d6d700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d0d1d2d3d4a0a1a2a3a4a5a6a7a7e6e700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e0e18081828384858687b5b6b7b7f6f700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
f0f19091929394959697c5c6c7c7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8081a0a1a2a3a4a5a6a7d5d6d7d7868700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9091b0b1b2b3b4b5b6b7e5e6e7e7969700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a0a1c0c1c2c3c4c5c6c7f5f6f7f7a6a700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b0b1d0d1d2d3d4d5d6d7d7b3b4b5b6b700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c0c1e0e1e2e3e4e5e6e7e7c3c4c5c6c700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d0d1f0f1f2f3f4f5f6f7f7d3d4d5d6d700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e0e1e2e3e4e5e6e7e0e1e2e3e4e5e6e700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
f0f1f2f3f4f5f6f7f0f1f2f3f4f5f6f700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
