pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
 game_over=false
 make_cave()
 make_player()
end
music(0)

function _update60()
 if game_over then
  if(btn()~=0) _init()
	else
		update_cave()
		move_player()
  check_hit()
 end
end

function _draw()
 cls()
 draw_cave()
 draw_player()
	if game_over then
	 print("game_over",44,44,7)
	 print("your score: "..player.score,34,54,7)
	 print("press any 🅾️ to play again ",18,72,6)
	else
	 print("score: "..player.score,2,2,7) 
 end
end

function make_player()
 player={
		x=24,
		y=60,
		dy=0, -- fall speed
		rise=2,
		fall=1,
		dead=3,
		speed=2, --fly speed
		score=0
 }
end

function draw_player()
	if game_over then
		spr(player.dead,player.x,player.y)
	elseif player.dy<0 then
		spr(player.rise,player.x,player.y)
	else
		spr(player.fall,player.x,player.y)	
	end
end

function move_player()
	gravity=0.2
	player.dy+=gravity
	
	if btnp(⬆️) or btnp(🅾️) then
		player.dy-=5
	 sfx(0)
	end
	
	player.y+=player.dy
	player.score+=player.speed
end

make_cave=function()
 cave={
  --seed with two empty segs
  --so that the deletion loop
  --in update_cave can run
 	{},{},
  {
  	top=5,
  	btm=119
  }
 }
 top=46
 btm=85
end

update_cave=function() 
 for i=1,player.speed do
		del(cave,cave[1])
 end

 while #cave<128 do
 	local col={}
 	local up=flr(rnd(7)-3)
 	local dwn=flr(rnd(7)-3)
 	col.top=mid(3,cave[#cave].top+up,top)
 	col.btm=mid(btm,cave[#cave].btm+dwn,124)
  add(cave,col)
 end
end

draw_cave=function() 
	top_color=6
	btm_color=6
	for i=1, #cave do
		line(i-1,0  ,i-1,cave[i].top,top_color)
		line(i-1,127,i-1,cave[i].btm,btm_color)
	end
end

check_hit=function()
	for i=player.x, player.x+7 do
		if cave[i+1].top>player.y or
		   cave[i+1].btm<player.y+7
		then
		 game_over = true
   sfx(1)		
		end
	end
end
__gfx__
0000000000aaaa0000aaaa0000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a7777a00a7171a009898989000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700aa1717aaaa7777aa88988898000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000aaaaaaaaaaaaaaaa89898989000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000aaaaaaaaaaaaaaaa88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700aa1111aaaa1111aa88999988000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaaaaa00aaaaaa008888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000aaaa0000aaaa0000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000400000f05022050010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0106000035153291531f153251531415317153001030b133061330813308123091130711306113061130010300103001030010300103001030010300103001030010300103001030010300103001030010300103
011800101803324003180332400318033000031803300003180330000318033000031803300003180330000300003000030000300003000030000300003000030000300003000030000300003000030000300003
0118001011555125551755516555115551155513555155550c5551755514555145551555517555155551755500505005050050500505005050050500505005050050500505005050050500505005050050500505
001800101a5501b5501b5501b5501a550265502b5502a5502355016550165501a550195501f550275502c55000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
01 02034344
02 02044344

